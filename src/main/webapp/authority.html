<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<head>
<meta charset="UTF-8">
<title>授权界面</title>
<!-- 新 Bootstrap 核心 CSS 文件 -->
<link rel="stylesheet"
	href="css/bootstrap-3.3.0-dist/dist/css/bootstrap.min.css">

<!-- 可选的Bootstrap主题文件（一般不用引入） -->
<link rel="stylesheet"
	href="css/bootstrap-3.3.0-dist/dist/css/bootstrap-theme.min.css">
<link rel="stylesheet" href="css/bootstrap-datetimepicker.min.css">
<!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
<script type="text/javascript" src="js/jquery.js"></script>
<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
<script type="text/javascript"
	src="css/bootstrap-3.3.0-dist/dist/js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/bootstrap-datetimepicker.min.js"></script>
<script type="text/javascript"
	src="js/locales/bootstrap-datetimepicker.zh-CN.js"></script>
<script type="text/javascript" src="js/angular/angular.min.js"></script>
<script type="text/javascript" src="js/interface.js"></script>
<script src="js/angular/controller.js"></script>
<script type="text/javascript">
window.onload = function() {
	//点击菜单页面控制
	$("#huiyishishouquan").click(function(){
		$("#huishouquancss").attr("class","active");
		$("#weidingyicss").attr("class","");
	});
	$("#weidingyi").click(function(){
		$("#weidingyicss").attr("class","active");
		$("#huishouquancss").attr("class","");
	});
 
}
</script>
</head>
<body >
	<div data-options="disabled:true,region:'north'"
		style="height: 150px; background-color: purple; width: 100%">
		<div
			style="color: orange; text-decoration: none; font-style: italic; padding-top: 50px; padding-left: 35%; width: 100%">
			<h1>欢迎使用视频会议室系统</h1>
		</div>
	</div>
	
	<div class="panel panel-default"  
		style="background-image: url('image/beijing6.jpg'); background-repeat: no-repeat; background-size: 100%;">
		<nav class="navbar navbar-default navbar-static-top"
				role="navigation">
				<div class="container-fluid" style="width: 100%;height: 100%;" >
					<div class="navbar-header">
						<a class="navbar-brand"><strong style="color: purple; text-decoration: none">授权菜单</strong></a>
					</div>
					<div>
						<ul class="nav navbar-nav">
							<li id="huishouquancss" class="active"><a id="huiyishishouquan" href="javaScrip:0">会议室管理授权</a></li>
							<li id="weidingyicss" ><a id="weidingyi" href="javaScrip:0">未定义 </a></li>
							<li class="dropdown"><a href="" class="dropdown-toggle"
								data-toggle="dropdown"> 未定义 <b class="caret"></b>
							</a>
								<ul class="dropdown-menu">
									<li><a href="">未定义 </a></li>
									<li><a href="">未定义 </a></li>
									<li><a href="">未定义 </a></li>
									<li class="divider"></li>
									<li><a href="">未定义 </a></li>
									<li class="divider"></li>
									<li><a href="">未定义 </a></li>
								</ul></li>
						</ul>
					</div>
				</div>
			</nav>
		<div style="height: 30px"></div>
		<div style="margin-left: 40px;">
			<strong>员工:</strong> <input id="userName" placeholder="必填"
				style="margin-left: 20px; width: 185px; height: 40px" /> <input
				id="yuangongid" type="text" hidden="true" name="employeeId"/>
		</div>
		<div ng-app="myApp" ng-controller="zuzhirenCtrl"
			style="z-index: 20; position: absolute;">
			<strong> <select id="zuhzirenleibaio"
				style="margin-left: 98px; margin-top:px; width: 185px; color: teal;"
				size="10" hidden="true">
					<option selected="selected">请选择</option>
					<option ng-repeat="zuhziren  in zuzhirens"
						value="{{zuhziren.userId}}">{{zuhziren.userName+"--"+zuhziren.mrDepartment.departmentName}}</option>
			</select>
			</strong>
		</div>
		<div style="height: 20px"></div>
		<div style="margin-left:40px;">
			<strong>角色:</strong>
				<select id="userRole"
				style="margin-left: 20px; width: 185px; color: teal;height: 40px;">
					<option value="ADMIN" >ADMIN</option>
			</select>
		</div>
		<div style="height: 50px"></div>
		<div style="margin-left: 40px;float: left;">
			<button id="shouquan" type="button" class="btn btn-lg btn-info" style="height: 40px;">授权</button>
		</div>
		<div style="margin-left: 200px;">
			<button id="jiechuquanxian" type="button" class="btn btn-lg btn-info" style="height: 40px;">解除权限</button>
		</div>
		<div style="height: 350px"></div>
		<div data-options="disabled:true,region:'north'"
			style="height: 150px; background-color: purple;">
			<div
				style="color: orange; text-decoration: none; font-style: italic; padding-top: 50px; padding-left: 35%;">
				<div style="margin-top: 50px; margin-left: 60%">
					<h5>质量管理与信息化办公室 制作 版权所有 2016</h5>
					<h5>MIS仅提供相关工具 所有具体内容均需按照公司制度执行</h5>
				</div>
			</div>
		</div>
	</div>
</body>
<script type="text/javascript">
var app = angular.module('myApp', []);
//获取页面数据
var yuangongid = document.getElementById('yuangongid');
var userRole =document.getElementById('userRole');
app.controller('zuzhirenCtrl', function($scope,$http) {
var userName = document.getElementById('userName');
userName.onkeyup=function(){
	  var url = MeettingRoominterfaces.Var_searchUserByName+userName.value+"?"+Math.random();
		 $http.get(url).success( function(response) {
          $scope.zuzhirens = response;
       });
	  var zuhzirenleibaio = document.getElementById('zuhzirenleibaio');
	  zuhzirenleibaio.removeAttribute("hidden");
	  zuhzirenleibaio.onchange=function(){
		  var hike = $scope.zuzhirens;
		  for(i=0;i<hike.length;i++){
			  if(hike[i].userId == zuhzirenleibaio.value){
				  yuangongid.value = zuhzirenleibaio.value;
				  userName.value = hike[i].userName; 
			  }
		  }
		  zuhzirenleibaio.hidden=true;
	  }
	  zuhzirenleibaio.onblur =function(){
		  var result=false;
		  var hike = $scope.zuzhirens;
		  if(hike==null||hike==""){
			  userName.value = null;
		  }else{
			  for(i=0;i<hike.length;i++){
				  if(hike[i].userName == userName.value){
					  result=true;
					  userName.value = hike[i].userName;
					  return;  
				  }
			  } 
		  }
		  if(!result)
		  {
			  userName.value = null;
		  }
		  zuhzirenleibaio.hidden=true; 
	  }
} 
});
//授权验证
$("#shouquan").click(function() {

	var UserRole =
	{
		    userId: yuangongid.value,
		    userRole: userRole.value,
		    userName: userName.value
		  } ;
		//获取所有的已授权人员
		if(yuangongid.value==""){
			alert("员工不能为空");
			return;
		}else if(userRole.value==""){
			alert("角色不能为空");
			return;
		}
		
	$.ajax({
			url : MeettingRoominterfaces.Var_seachAllUserRole,
			type : "get",
			success : function(data) {
				var length = data.length;
				for (i = 0; i < length; i++) {
					if (data[i].userId == yuangongid.value) {
						alert("该用户已授权");
						return;
					}
				}
				$.ajax({
					url : MeettingRoominterfaces.Var_InsertUserRole,
					type : "POST",
					contentType : "application/json",
					data : JSON.stringify(UserRole),
					success : function(data) {
						alert("授权成功");
						yuangongid.value = null;
						userName.value = null;
					}
				});
			}
		});
	});
	
	//解除权限
	$("#jiechuquanxian").click(function(){
		if(yuangongid.value==""){
			alert("员工不能为空");
			return;
		}
		$.ajax({
			url : MeettingRoominterfaces.Var_deleteUserRole+yuangongid.value,
			type : "delete",
			success : function(data) {
				alert("解除成功");
				yuangongid.value = null;
				userName.value = null;
			}
		});
	});
</script>
</html>